import { WinningSettlementData } from "../src/models";
import { getSettlementCompetitionData } from "../src/orderbook";

describe("getSettlementCompetitionData(txHash)", () => {
  test("Successful Fetch of Competition Data", async () => {
    const txHash =
      "0x22bfb44e689e14e5b7b6d1ee7cb5fc2eb9e0db87f8fb54cc2baffc7ea17babdf";
    const expected: WinningSettlementData = {
      simulationBlock: 16921406,
      solver: "0xa21740833858985e4d801533a808786d3647fb83",
      reducedCallData:
        "0x13d79a0b000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000000e00000000000000000000000000000000000000000000000000000000000000140000000000000000000000000000000000000000000000000000000000000036000000000000000000000000000000000000000000000000000000000000000020000000000000000000000002b591e99afe9f32eaa6214f7b7629768c40eeb39000000000000000000000000a0b86991c6218b36c1d19d4a2e9eb0ce3606eb48000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000106ce33c8b4baf000000000000000000000000000000000000000000000000511e1b8aec5aa9e000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000007372e0104e081b674b8a4b840e4cf9657d80b0170000000000000000000000000000000000000000000000000000000026b2081e000000000000000000000000000000000000000000000000000000bd88ca489d000000000000000000000000000000000000000000000000000000006422124e3f1aabaf92e2f1cdd097c8712ef50a412c7e37e28ac7d08c63b9eba3d64f2b8d0000000000000000000000000000000000000000000000000000000000af258600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000026b2081e0000000000000000000000000000000000000000000000000000000000000160000000000000000000000000000000000000000000000000000000000000004178e1b713560c24e0eb5861322c04de2904d2ffe7cee23800da5594490f6c326a557026ee95e19b77a3bf2cc227bff421d01cf5efe01a29973e18b94885d7e1e81b000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000060000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000000a0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
      fullCallData:
        "0x13d79a0b000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000000e00000000000000000000000000000000000000000000000000000000000000140000000000000000000000000000000000000000000000000000000000000036000000000000000000000000000000000000000000000000000000000000000020000000000000000000000002b591e99afe9f32eaa6214f7b7629768c40eeb39000000000000000000000000a0b86991c6218b36c1d19d4a2e9eb0ce3606eb48000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000106ce33c8b4baf000000000000000000000000000000000000000000000000511e1b8aec5aa9e000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000007372e0104e081b674b8a4b840e4cf9657d80b0170000000000000000000000000000000000000000000000000000000026b2081e000000000000000000000000000000000000000000000000000000bd88ca489d000000000000000000000000000000000000000000000000000000006422124e3f1aabaf92e2f1cdd097c8712ef50a412c7e37e28ac7d08c63b9eba3d64f2b8d0000000000000000000000000000000000000000000000000000000000af258600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000026b2081e0000000000000000000000000000000000000000000000000000000000000160000000000000000000000000000000000000000000000000000000000000004178e1b713560c24e0eb5861322c04de2904d2ffe7cee23800da5594490f6c326a557026ee95e19b77a3bf2cc227bff421d01cf5efe01a29973e18b94885d7e1e81b000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000060000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000005e0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000020000000000000000000000000def171fe48cf0115b1d80b88dc8eab59176fee5700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000060000000000000000000000000000000000000000000000000000000000000048454e3f31b0000000000000000000000000000000000000000000000000000000000000020000000000000000000000000a0b86991c6218b36c1d19d4a2e9eb0ce3606eb480000000000000000000000002b591e99afe9f32eaa6214f7b7629768c40eeb390000000000000000000000000000000000000000000000000000000026b2081e000000000000000000000000000000000000000000000000000000be24f7392c000000000000000000000000000000000000000000000000000000bf1992d66700000000000000000000000000000000000000000000000000000000000001e0000000000000000000000000000000000000000000000000000000000000022000000000000000000000000000000000000000000000000000000000000003a000000000000000000000000000000000000000000000000000000000000004000000000000000000000000009008d19f58aabd9ed0d60971565aa8510560ab410000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000004400000000000000000000000000000000000000000000000000000000064225fc1e5f2a890f35d4ed5973b43c590d62bfc000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000e592427a0aece92de3edee1f18e0157c058615640000000000000000000000000000000000000000000000000000000000000144c04b8d59000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000a0000000000000000000000000def171fe48cf0115b1d80b88dc8eab59176fee5700000000000000000000000000000000000000000000000000000000642219700000000000000000000000000000000000000000000000000000000026b2081e00000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000042a0b86991c6218b36c1d19d4a2e9eb0ce3606eb480027103819f64f282bf135d62168c1e513280daf905e060027102b591e99afe9f32eaa6214f7b7629768c40eeb3900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000144000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
    };

    expect(await getSettlementCompetitionData(txHash)).toEqual(expected);
  });

  test("Successful Fetch of Competition Data (not internalized)", async () => {
    const txHash =
      "0xf1df7c1d068c2e0f0cf324bb0739a838fff89b4b08bf2aa11a7b4a609a7e20fe";
    const expected: WinningSettlementData = {
      simulationBlock: 16815371,
      solver: "0xb20b86c4e6deeb432a22d773a221898bbbd03036",
      reducedCallData:
        "0x13d79a0b000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000000e00000000000000000000000000000000000000000000000000000000000000140000000000000000000000000000000000000000000000000000000000000032000000000000000000000000000000000000000000000000000000000000000020000000000000000000000006b175474e89094c44da98b954eedeac495271d0f000000000000000000000000a0b86991c6218b36c1d19d4a2e9eb0ce3606eb48000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000700c9fcf884000000000000000000000000000000000000000000065e883878f2194c9c40000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000b1bd5762faf7d6f86f965a3ff324bd81bb746d0000000000000000000000000000000000000000000000000000000700c9fcf884000000000000000000000000000000000000000000065db783323aae88dc2c0000000000000000000000000000000000000000000000000000000000640e6ac08800ad388e0744a5c2473416d0a012e057f638bfebe35947513b2de7693c09530000000000000000000000000000000000000000000000000000000001c6cf7c000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000700c9fcf88400000000000000000000000000000000000000000000000000000000000001600000000000000000000000000000000000000000000000000000000000000014b1bd5762faf7d6f86f965a3ff324bd81bb746d000000000000000000000000000000000000000000000000000000000000000000000000000000000000000060000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000003400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000200000000000000000000000001111111254eeb25477b68fb85ed929f73a9605820000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000001e812aa3caf0000000000000000000000007122db0ebe4eb9b434a9f2ffe6760bc03bfbd0e0000000000000000000000000a0b86991c6218b36c1d19d4a2e9eb0ce3606eb480000000000000000000000006b175474e89094c44da98b954eedeac495271d0f0000000000000000000000007122db0ebe4eb9b434a9f2ffe6760bc03bfbd0e00000000000000000000000009008d19f58aabd9ed0d60971565aa8510560ab4100000000000000000000000000000000000000000000000000000700c9fcf884000000000000000000000000000000000000000000065e84e19aa157143af8000000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000014000000000000000000000000000000000000000000000000000000000000001600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005200000000000000000000000000000000000000000000000000003400000600a0fd53121f80a06c4eca276b175474e89094c44da98b954eedeac495271d0f1111111254eeb25477b68fb85ed929f73a9605820000000000000000000000000000d26cd1970000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
    };
    expect(await getSettlementCompetitionData(txHash)).toEqual(expected);
  });

  test("Fails to Fetch Barn Competition Data", async () => {
    const expected: WinningSettlementData = {
      simulationBlock: 16921000,
      solver: "0x1857afb4da9bd4cc1c6e5287ad41cb5be469f14e",
      reducedCallData:
        "0x13d79a0b000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000000e00000000000000000000000000000000000000000000000000000000000000140000000000000000000000000000000000000000000000000000000000000036000000000000000000000000000000000000000000000000000000000000000020000000000000000000000002b591e99afe9f32eaa6214f7b7629768c40eeb390000000000000000000000006b175474e89094c44da98b954eedeac495271d0f0000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000ffffffffffffffff00000000000000000000000000000000000000000000000000000005b4008c0e00000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010000000000000000000000006b434f8e80e8b85a63a9f4ff0a14eb9568a827c8000000000000000000000000000000000000000000000000000000f7362f7d9b00000000000000000000000000000000000000000000002b135aafbb4539447a000000000000000000000000000000000000000000000000000000006421fefab7c9d7d3e5f06f4d581b8cd009cfbac2671bacc5a4c17a07efa451a34c8fd13a00000000000000000000000000000000000000000000000000000004e1c6f2f60000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f7362f7d9b00000000000000000000000000000000000000000000000000000000000001600000000000000000000000000000000000000000000000000000000000000041d9d3e1a75f718116f87a8a0f84ee9e7040dbaa434162aa25d5756b3d138e33a523e85d995c3e6e6e99c2cd299c533668173dba294513f90a746083c8adfc05801c000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000060000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000000a0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
      fullCallData:
        "0x13d79a0b000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000000e00000000000000000000000000000000000000000000000000000000000000140000000000000000000000000000000000000000000000000000000000000036000000000000000000000000000000000000000000000000000000000000000020000000000000000000000002b591e99afe9f32eaa6214f7b7629768c40eeb390000000000000000000000006b175474e89094c44da98b954eedeac495271d0f0000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000ffffffffffffffff00000000000000000000000000000000000000000000000000000005b4008c0e00000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010000000000000000000000006b434f8e80e8b85a63a9f4ff0a14eb9568a827c8000000000000000000000000000000000000000000000000000000f7362f7d9b00000000000000000000000000000000000000000000002b135aafbb4539447a000000000000000000000000000000000000000000000000000000006421fefab7c9d7d3e5f06f4d581b8cd009cfbac2671bacc5a4c17a07efa451a34c8fd13a00000000000000000000000000000000000000000000000000000004e1c6f2f60000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f7362f7d9b00000000000000000000000000000000000000000000000000000000000001600000000000000000000000000000000000000000000000000000000000000041d9d3e1a75f718116f87a8a0f84ee9e7040dbaa434162aa25d5756b3d138e33a523e85d995c3e6e6e99c2cd299c533668173dba294513f90a746083c8adfc05801c00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000800000000000000000000000000000000000000000000000000000000000000580000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000060000000000000000000000000000000000000000000000000000000000000014000000000000000000000000000000000000000000000000000000000000002800000000000000000000000002b591e99afe9f32eaa6214f7b7629768c40eeb39000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000600000000000000000000000000000000000000000000000000000000000000044a9059cbb000000000000000000000000f6dcdce0ac3001b2f67f750bc64ea5beb37b5824000000000000000000000000000000000000000000000000000000f7362f7d9b00000000000000000000000000000000000000000000000000000000000000000000000000000000f6dcdce0ac3001b2f67f750bc64ea5beb37b58240000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000a4022c0d9f0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002fa8c3840000000000000000000000009008d19f58aabd9ed0d60971565aa8510560ab410000000000000000000000000000000000000000000000000000000000000080000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ba12222222228d8ba445958a75a0704d566bf2c80000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000001c452bbbe2900000000000000000000000000000000000000000000000000000000000000e00000000000000000000000009008d19f58aabd9ed0d60971565aa8510560ab4100000000000000000000000000000000000000000000000000000000000000000000000000000000000000009008d19f58aabd9ed0d60971565aa8510560ab41000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002ad373ce668e9800000000000000000000000000000000000000000000000000000000000064237eb306df3b2bbb68adc8b0e302443692037ed9f91b420000000000000000000000630000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a0b86991c6218b36c1d19d4a2e9eb0ce3606eb480000000000000000000000006b175474e89094c44da98b954eedeac495271d0f000000000000000000000000000000000000000000000000000000002fa8c38400000000000000000000000000000000000000000000000000000000000000c00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
    };
    expect(
      await getSettlementCompetitionData(
        "0xb45e23e7557094f1deed1b43bf229df4eef17b0dc7874241bbf1ed17ca21e4ae"
      )
    ).toEqual(expected);
  });

  test("Fails to Fetch invalid txHash", async () => {
    expect(await getSettlementCompetitionData("0x")).toBeUndefined();
  });
});
